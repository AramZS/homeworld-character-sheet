<!DOCTYPE html>
<html>
<head>
  <title>Homeworld Revelations Character Sheet Creator and Manager</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background-color: #f0f0f0;
    }

    .character-sheet {
      background-color: #fff;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .header {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .basic-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .section {
      background-color: #2b4b8c;
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .attributes-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .attributes-grid label, .skills-grid label {
      color: white;
    }

    .skills-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .weapon-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .weapon-table th, .weapon-table td {
      border: 1px solid #ccc;
      padding: 8px;
    }

    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      resize: vertical;
    }

    .stress-boxes {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      margin: 10px 0;
    }

    .stress-box {
      width: 20px;
      height: 20px;
      border: 1px solid #000;
    }

    label {
      font-weight: bold;
      color: #333;
    }

    .add-weapon-btn, .save-form, .retrieve-form {
      background-color: #2b4b8c;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }

    .add-weapon-btn:hover, .save-form:hover, .retrieve-form:hover {
      background-color: #3a5ca0;
    }

    .table-container {
      margin-bottom: 20px;
    }

    .save-form-button-container {
      text-align: right;
    }
    
    .character-info {
      display: grid; 
      grid-template-columns: repeat(3, 1fr); 
      gap: 20px;
    }
    
    @media (max-width:500px)  { /* smartphones, Android phones, landscape iPhone */ 
      .character-info {
        display: grid; 
        grid-template-columns: repeat(1, 1fr); 
        gap: 20px;
      }
    
    }
  </style>
</head>
<body>
  <h1>
    Homeworld Revelations Character Sheet
  </h1>
  <div class="character-sheet">
    <div class="header">
      <div style="flex: 1">
        <label for="name">Name:</label>
        <input type="text" id="name">
      </div>
      <div style="flex: 1">
        <label for="role">Role:</label>
        <input type="text" id="role">
      </div>
    </div>

    <div class="basic-info">
      <div>
        <label for="kiith-background">Kiith Background:</label>
        <input type="text" id="kiith-background">
        <br><br>
        <label for="environment">Environment:</label>
        <input type="text" id="environment">
        <br><br>
        <label for="upbringing">Upbringing:</label>
        <input type="text" id="upbringing">
        <br><br>
        <label for="rank">Rank:</label>
        <input type="text" id="rank">
        <br><br>
        <label for="requisition-units">Requisition Units:</label>
        <input type="number" id="requisition-units" value="0">
      </div>

      <div>
        <label for="armor-rating">Armor Rating:</label>
        <input type="number" id="armor-rating" value="0">
        <br><br>
        <label for="max-stress">Max Stress:</label>
        <div class="stress-boxes" id="max-stress">
          <input type="checkbox" class="stress-box" id="stress-1">
          <input type="checkbox" class="stress-box" id="stress-2">
          <input type="checkbox" class="stress-box" id="stress-3">
          <input type="checkbox" class="stress-box" id="stress-4">
          <input type="checkbox" class="stress-box" id="stress-5">
          <input type="checkbox" class="stress-box" id="stress-6">
          <input type="checkbox" class="stress-box" id="stress-7">
          <input type="checkbox" class="stress-box" id="stress-8">
          <input type="checkbox" class="stress-box" id="stress-9">
          <input type="checkbox" class="stress-box" id="stress-10">
          <input type="checkbox" class="stress-box" id="stress-11">
          <input type="checkbox" class="stress-box" id="stress-12">
          <input type="checkbox" class="stress-box" id="stress-13">
          <input type="checkbox" class="stress-box" id="stress-14">
          <input type="checkbox" class="stress-box" id="stress-15">
        </div>
        <label for="injury">Injury:</label>
        <div class="stress-boxes" id="injury" style="grid-template-columns: repeat(3, 1fr);">
          <input type="checkbox" class="stress-box" id="injury-1">
          <input type="checkbox" class="stress-box" id="injury-2">
          <input type="checkbox" class="stress-box" id="injury-3">
          <input type="checkbox" class="stress-box" id="injury-4">
        </div>
      </div>
    </div>

    <div class="section">
      <h3>Attributes</h3>
      <div class="attributes-grid">
        <div>
          <label for="agility">Agility:</label>
          <input type="number" id="agility" value="0">
        </div>
        <div>
          <label for="brawn">Brawn:</label>
          <input type="number" id="brawn" value="0">
        </div>
        <div>
          <label for="coordination">Coordination:</label>
          <input type="number" id="coordination" value="0">
        </div>
        <div>
          <label for="insight">Insight:</label>
          <input type="number" id="insight" value="0">
        </div>
        <div>
          <label for="reason">Reason:</label>
          <input type="number" id="reason" value="0">
        </div>
        <div>
          <label for="will">Will:</label>
          <input type="number" id="will" value="0">
        </div>
      </div>
    </div>

    <div class="section">
      <h3>Skills</h3>
      <div class="skills-grid">
        <div>
          <label for="combat">Combat:</label>
          <input type="number" id="combat" value="0">
        </div>
        <div>
          <label for="command">Command:</label>
          <input type="number" id="command" value="0">
        </div>
        <div>
          <label for="engineering">Engineering:</label>
          <input type="number" id="engineering" value="0">
        </div>
        <div>
          <label for="exploration">Exploration:</label>
          <input type="number" id="exploration" value="0">
        </div>
        <div>
          <label for="flight">Flight:</label>
          <input type="number" id="flight" value="0">
        </div>
        <div>
          <label for="medical">Medical:</label>
          <input type="number" id="medical" value="0">
        </div>
      </div>
    </div>

    <div class="section">
      <h3>Equipment</h3>
      <textarea id="equipment" rows="4"></textarea>
    </div>

    <div style="" class="character-info">
      <div class="section">
        <h3>Focuses</h3>
        <textarea id="focuses" rows="4"></textarea>
      </div>

      <div class="section">
        <h3>Defining Aspects</h3>
        <textarea id="defining-aspects" rows="4"></textarea>
      </div>

      <div class="section">
        <h3>Truths and Talents</h3>
        <textarea id="truths-talents" rows="4"></textarea>
      </div>
    </div>
    <div class="table-container">
      <table class="weapon-table" id="weaponTable">
        <thead>
          <tr>
            <th>Weapon</th>
            <th>Stress Rating</th>
            <th>Range and Type</th>
            <th>Effects</th>
            <th>Qualities</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input type="text" id="weapon-1"></td>
            <td><input type="number" id="stress-rating-1"></td>
            <td><input type="text" id="range-type-1"></td>
            <td><input type="text" id="effects-1"></td>
            <td><input type="text" id="qualities-1"></td>
          </tr>
        </tbody>
      </table>
      <button class="add-weapon-btn" onclick="addWeaponRow()">Add Weapon</button>
    </div>
  </div>
  <div class="save-form-button-container">
    <button onclick="saveInfo()" class="save-form" type="button">Save</button>
	<button onclick="fillSavedInfo()" class="retrieve-form" type="button">Retrieve</button>
    <button onclick="exportInfo()" class="retrieve-form" type="button">Export</button>
    <button onclick="importInfo()" class="retrieve-form" type="button">Import</button>
        <button onclick="generateFilledShareURL()" class="retrieve-form" type="button">Generate Share URL</button>
    <br /><br /><small>Save and Retrieve will work with LocalStorage. Import and URL based retrieval of your character will overwrite localStorage saved values. </small>
  </div>
  
  <script language="javascript" src="base64-string.js" ></script>
  <script language="javascript" src="lz-string.min.js" ></script>
  <script>
    function addWeaponRow() {
      const table = document.getElementById('weaponTable').getElementsByTagName('tbody')[0];
      const newRow = table.insertRow();
      const rowCount = table.rows.length;

      // Create cells with inputs
      for (let i = 0; i < 5; i++) {
        const cell = newRow.insertCell();
        const input = document.createElement('input');
        input.type = i === 1 ? 'number' : 'text';
        input.id = `weapon-${rowCount}-${i}`;
        cell.appendChild(input);
      }
    }

	function saveInfo() {
      const inputs = document.querySelectorAll('input, textarea');
      inputs.forEach(input => {
        localStorage.setItem(input.id, input.type === 'checkbox' ? input.checked : input.value);
      });
      console.log('Data saved to localStorage');
    }

	function fillSavedInfo() {
      
      const weaponTable = document.getElementById('weaponTable').getElementsByTagName('tbody')[0];
      let maxWeaponRow = 1;

      // Check for weapon rows in localStorage and create new rows if necessary
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        const match = key.match(/^weapon-(\d+)-(\d+)$/);
        if (match) {
          const rowIndex = parseInt(match[1], 10);
          if (rowIndex > maxWeaponRow) {
            maxWeaponRow = rowIndex;
            addWeaponRow();
          }
        }
      }
      const inputs = document.querySelectorAll('input, textarea');
      inputs.forEach(input => {
        const savedValue = localStorage.getItem(input.id);
        if (savedValue !== null) {
          if (input.type === 'checkbox') {
            input.checked = savedValue === 'true';
          } else {
            input.value = savedValue;
          }
        }
      });

      console.log('Data retrieved from localStorage');
	}
    

	function importInfo() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'application/json';
      input.onchange = event => {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = e => {
          localStorage.clear();

          const data = JSON.parse(e.target.result);
          for (const key in data) {
            localStorage.setItem(key, data[key]);
          }
          console.log('Data imported from JSON');
          fillSavedInfo();
        };
        reader.readAsText(file);
      };
      input.click();
    }    
    
	function exportInfo() {
      const inputs = document.querySelectorAll('input, textarea');
      const data = {};

      inputs.forEach(input => {
        data[input.id] = input.type === 'checkbox' ? input.checked : input.value;
      });

      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'character-sheet.json';
      a.click();
      URL.revokeObjectURL(url);

      console.log('Data exported as JSON');
    }
    


	function generateFilledShareURL() {
      const inputs = document.querySelectorAll('input, textarea');
      const data = {};

      inputs.forEach(input => {
        data[input.id] = input.type === 'checkbox' ? input.checked : input.value;
      });

      const json = LZString.compressToEncodedURIComponent(JSON.stringify(data));
      console.log('Compressed string', json)
      const encodedData = json;
      const url = `${window.location.origin}${window.location.pathname}?data=${encodedData}`;
      prompt('Share this URL:', url);

      console.log('Share URL generated');
    }

    function decodeShareURL() {
      const params = new URLSearchParams(window.location.search);
      const encodedData = params.get('data');
      if (encodedData) {
        const json = LZString.decompressFromEncodedURIComponent(decodeURIComponent(encodedData));
        const data = JSON.parse(json);
        localStorage.clear();

        for (const key in data) {
          localStorage.setItem(key, data[key]);
        }
        fillSavedInfo();
        console.log('Data decoded from URL and loaded');
      }
    }
    
    
    window.onload = decodeShareURL;
    
  </script>
  
  
</body>
</html>
